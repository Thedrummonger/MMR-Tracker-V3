@page "/fetchdata"

@using MMR_Tracker_V3;
@using MauiFrontEnd.Data
@inject WeatherForecastService ForecastService

<h1>Available Locations</h1>

@if (InstanceContainer == null || InstanceContainer.Instance == null)
{
	<p><em>Loading...</em></p>
}
else
{
	<table class="table">
		<thead>
			<tr>
				<th>Location</th>
				<th>Item</th>
				<th>Area</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var Entry in DataSets.AvailableLocations)
			{
				<tr>
					<td>@Entry.GetDictEntry(InstanceContainer.Instance).GetName(InstanceContainer.Instance)</td>
					<td>@GetDisplayeName(Entry.Randomizeditem.Item)</td>
					<td>@Entry.GetDictEntry(InstanceContainer.Instance).Area</td>
				</tr>
			}
		</tbody>
	</table>
}

@code {
	private MMR_Tracker_V3.TrackerObjects.MiscData.InstanceContainer InstanceContainer = new() { Instance = new() };

	private MMR_Tracker_V3.TrackerDataHandeling.DataSets DataSets = new();

	string UnknownItem = "?????";

	protected override async Task OnInitializedAsync()
	{
		System.Net.WebClient wc = new System.Net.WebClient();
		var Logic = wc.DownloadString("https://raw.githubusercontent.com/ZoeyZolotova/mm-rando/dev/MMR.Randomizer/Resources/REQ_CASUAL.txt");
		System.Diagnostics.Debug.WriteLine("Downloaded Logic");

		var Dictionary = wc.DownloadString("https://raw.githubusercontent.com/Thedrummonger/MMR-Tracker-V3/master/MMR%20Tracker%20V3/Recources/Dictionaries/MMR%20V11.json");
		System.Diagnostics.Debug.WriteLine("Downloaded Dict");

		MMR_Tracker_V3.LogicObjects.TrackerInstance TempInstance = new LogicObjects.TrackerInstance();
		TempInstance.GenerateInstance(Logic, Dictionary);

		InstanceContainer.Instance = TempInstance;

		InstanceContainer.logicCalculation.CalculateLogic();

		DataSets = MMR_Tracker_V3.TrackerDataHandeling.PopulateDataSets(InstanceContainer.Instance);
	}

	private string GetDisplayeName(string Item)
	{
		return string.IsNullOrWhiteSpace(Item) ? "???" : Item;
	}
}
